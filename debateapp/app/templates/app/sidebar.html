{% load static %}

<div
  id="sidebar"
  class="h-screen bg-gray-800 transition-all duration-300 ease-in-out relative"
  :class="{'w-20': !isExpanded, 'w-64': isExpanded}"
>
  <!-- Genişlet/Daralt Butonu -->
  <button
    @click="isExpanded = !isExpanded"
    class="absolute -right-3 top-1/2 transform -translate-y-1/2 w-6 h-12 bg-gray-700 rounded-r-md flex items-center justify-center hover:bg-gray-600 transition-colors duration-200"
  >
    <svg
      :class="{'rotate-180': isExpanded}"
      class="w-4 h-4 text-gray-300 transition-transform duration-300"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    >
      <path d="M15 18l-6-6 6-6" />
    </svg>
  </button>
  {% if user.is_authenticated%}
  <div class="p-3 border-b border-gray-700">
    <a href="{% url 'create_room' %}" 
      class="flex items-center justify-center w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors duration-200">
      <span class="text-white" x-show="isExpanded">Yeni Oda</span>
      <svg x-show="!isExpanded" class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
      </svg>
    </a>
  </div>
    <!-- Odalar Listesi -->
    <div class="py-4 px-3 space-y-4">
      {% if rooms is none or rooms.count == 0 %}
      <p class="text-gray-400 text-center">Henüz bir oda yok</p>
      {% else %}
      {% for room in rooms %}
      <a
        href="{% url 'room_detail' room.id %}"
        class="flex items-center space-x-3 {% if room.id == current_room.id %}bg-blue-600{% else %}hover:bg-gray-700{% endif %} rounded-lg transition-colors duration-200 p-2"
      >
        <!-- Oda Avatarı -->
        <div
          class="flex-shrink-0 w-12 h-12 rounded-full overflow-hidden flex items-center justify-center {% if room.id == current_room.id %}bg-blue-700{% else %}bg-gray-700{% endif %}"
        >
          {% if room.image %}
          <img
            src="{{ room.image.url }}"
            alt="{{ room.name }}"
            class="w-full h-full object-cover"
          />
          {% else %}
          <span class="text-lg font-semibold"
            >{{ room.get_initials }}</span
          >
          {% endif %}
        </div>

        <!-- Oda Bilgileri - Genişletilmiş Halde Gösterilir -->
        <div
          class="flex-1 overflow-hidden transition-all duration-300"
          :class="{'opacity-0 w-0': !isExpanded, 'opacity-100 w-auto': isExpanded}"
        >
          <div class="truncate font-medium">{{ room.name }}</div>
          <div class="text-sm text-gray-400 truncate">
            {{ room.participant_count }} Katılımcı
          </div>
        </div>

        <!-- Aktif Oda Göstergesi -->
        {% if room.id == current_room.id %}
        <div
          class="w-2 h-2 rounded-full bg-blue-400 flex-shrink-0"
          :class="{'ml-auto': isExpanded}"
        ></div>
        {% endif %}
      </a>
      {% endfor %}
      {% endif %}
    </div>
    <div class="mt-auto p-3 border-t border-gray-700">
      <a href="{% url 'logout' %}" 
        class="flex items-center space-x-3 hover:bg-gray-700 rounded-lg transition-colors duration-200 p-2">
        <div class="flex-shrink-0 w-10 h-10 rounded-full bg-red-600 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M3 3a1 1 0 011 1v12a1 1 0 11-2 0V4a1 1 0 011-1zm7.707 3.293a1 1 0 010 1.414L9.414 9H17a1 1 0 110 2H9.414l1.293 1.293a1 1 0 01-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="flex-1 overflow-hidden transition-all duration-300"
            x-show="isExpanded">
          <div class="text-gray-300 font-medium">Çıkış Yap</div>
        </div>
      </a>
    </div>
  {% else %}
  <div class="p-3 border-b border-gray-700">
    <a href="{% url 'signup' %}" 
      class="flex items-center justify-center w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors duration-200">
      <span class="text-white" x-show="isExpanded">Kayıt Ol</span>
      <svg x-show="!isExpanded" class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
      </svg>
    </a>
  </div>

  {% endif %}
</div>
